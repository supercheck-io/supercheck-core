apiVersion: networking.k8s.io/v1
kind: IngressClass
metadata:
  name: traefik
  annotations:
    ingressclass.kubernetes.io/is-default-class: "true"
spec:
  controller: traefik.io/ingress-controller
---
# Main Supercheck Application Ingress
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: supercheck-ingress
  namespace: supercheck
  labels:
    app.kubernetes.io/name: supercheck
    app.kubernetes.io/component: ingress
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: websecure
    traefik.ingress.kubernetes.io/router.tls.certresolver: letsencrypt
    traefik.ingress.kubernetes.io/router.middlewares: supercheck-headers@kubernetescrd
    # WebSocket support for real-time updates
    traefik.ingress.kubernetes.io/service.websocket: "true"
    # File upload size for test artifacts
    traefik.ingress.kubernetes.io/router.middlewares: supercheck-upload-size@kubernetescrd
spec:
  ingressClassName: traefik
  tls:
  - hosts:
    - supercheck.yourdomain.com
    secretName: supercheck-tls
  rules:
  - host: supercheck.yourdomain.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: supercheck-app-service
            port:
              number: 3000
---
# MinIO Console Ingress (Optional)
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: minio-console-ingress
  namespace: supercheck
  labels:
    app: minio
    component: console
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: websecure
    traefik.ingress.kubernetes.io/router.tls.certresolver: letsencrypt
    traefik.ingress.kubernetes.io/router.middlewares: minio-auth@kubernetescrd
spec:
  ingressClassName: traefik
  tls:
  - hosts:
    - minio.yourdomain.com
    secretName: minio-tls
  rules:
  - host: minio.yourdomain.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: minio-service
            port:
              number: 9001
---
# MinIO API Ingress for direct S3 access
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: minio-api-ingress
  namespace: supercheck
  labels:
    app: minio
    component: api
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: websecure
    traefik.ingress.kubernetes.io/router.tls.certresolver: letsencrypt
    # Larger upload size for artifacts
    traefik.ingress.kubernetes.io/router.middlewares: minio-upload@kubernetescrd
spec:
  ingressClassName: traefik
  tls:
  - hosts:
    - s3.yourdomain.com
    secretName: minio-api-tls
  rules:
  - host: s3.yourdomain.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: minio-service
            port:
              number: 9000